<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VDO.Ninja API Console</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #6366f1;
      --primary-light: #818cf8;
      --primary-dark: #4f46e5;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-600: #4b5563;
      --gray-800: #1f2937;
      --radius: 0.5rem;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--gray-800);
      background: linear-gradient(to right, #f0f4ff, #e0e7ff);
      line-height: 1.5;
      padding: 1rem;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }
    
    header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 1rem;
      background: white;
      border-radius: var(--radius);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    h1, h2, h3, h4 {
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    h1 {
      font-size: 2rem;
      color: var(--primary-dark);
    }
    
    .api-key {
      font-weight: 600;
      padding: 0.5rem 1rem;
      background: var(--gray-100);
      border-radius: var(--radius);
      display: inline-block;
      margin: 0.5rem 0;
      cursor: pointer;
      user-select: all;
      border: 1px solid var(--gray-300);
    }
    
    /* Tabs styling */
    .tabs {
      display: flex;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--gray-300);
    }
    
    .tab {
      padding: 0.75rem 1.5rem;
      font-weight: 500;
      cursor: pointer;
      position: relative;
      border-bottom: 2px solid transparent;
    }
    
    .tab.active {
      border-bottom: 2px solid var(--primary);
      color: var(--primary);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Grid layout for buttons */
    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }
    
    /* Button styling */
    button {
      background: white;
      color: var(--gray-800);
      border: 1px solid var(--gray-300);
      border-radius: var(--radius);
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      min-height: 4rem;
    }
    
    button:hover {
      border-color: var(--primary-light);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    button:active {
      background-color: var(--gray-100);
      transform: translateY(1px);
    }
    
    button[data-type="true"] {
      border-left: 3px solid var(--success);
    }
    
    button[data-type="false"] {
      border-left: 3px solid var(--danger);
    }
    
    button[data-type="toggle"] {
      border-left: 3px solid var(--warning);
    }
    
    .section {
      background: white;
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .section-title {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
      font-weight: 600;
      color: var(--primary-dark);
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--gray-200);
    }
    
    /* PTZ Controls */
    .ptz-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-top: 1rem;
    }
    
    .control-group {
      flex: 1;
      min-width: 200px;
    }
    
    .slider-wrapper {
      margin-bottom: 1rem;
    }
    
    .slider-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .slider-container {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .slider {
      flex: 1;
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: var(--gray-300);
      outline: none;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }
    
    .slider-value {
      font-size: 0.875rem;
      min-width: 40px;
      text-align: center;
    }
    
    /* Request/Response Logger */
    .api-logger {
      height: 300px;
      max-height: 300px;
      overflow-y: auto;
      background: #1a1a1a;
      color: #f8f8f8;
      font-family: 'Courier New', monospace;
      padding: 1rem;
      border-radius: var(--radius);
      font-size: 0.875rem;
    }
    
    .log-entry {
      margin-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 0.5rem;
    }
    
    .log-time {
      color: #a8a8a8;
    }
    
    .log-method {
      display: inline-block;
      padding: 0.125rem 0.375rem;
      border-radius: 3px;
      margin: 0 0.5rem;
      font-weight: 500;
      font-size: 0.75rem;
    }
    
    .log-get {
      background: #4caf50;
      color: white;
    }
    
    .log-ws {
      background: #2196f3;
      color: white;
    }
    
    .log-request {
      color: #64b5f6;
    }
    
    .log-response {
      color: #81c784;
    }
    
    .log-error {
      color: #ef5350;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .button-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      }
      
      .ptz-controls {
        flex-direction: column;
        gap: 1rem;
      }
    }
    
    /* Tooltip */
    .tooltip {
      position: relative;
      cursor: pointer;
    }
    
    .tooltip .tooltip-text {
      visibility: hidden;
      width: 300px;
      background-color: #333;
      color: white;
      text-align: left;
      border-radius: 4px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      top: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.75rem;
      font-family: monospace;
      white-space: pre-wrap;
    }
    
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    
    /* Connection status */
    .connection-status {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.5rem;
      border-radius: 12px;
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }
    
    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    
    .status-connected {
      background: var(--success);
      color: var(--success);
      border: 1px solid var(--success);
    }
    
    .status-disconnected {
      background: var(--danger);
      color: var(--danger);
      border: 1px solid var(--danger);
    }
    
    .status-connecting {
      background: var(--warning);
      color: var(--warning);
      border: 1px solid var(--warning);
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>VDO.Ninja API Console</h1>
    <p>Remote control VDO.Ninja using HTTP or WebSocket API</p>
    <div id="api-key-container">
      <p>Your API Key: <span class="api-key" id="api-key" onclick="copyToClipboard(this)">Loading...</span></p>
      <div class="connection-status">
        <span class="status-indicator status-connecting" id="connection-indicator"></span>
        <span id="connection-status">Connecting...</span>
      </div>
    </div>
    <p>Your Ninja Link: <a id="ninja-link" href="#" target="_blank">Loading...</a></p>
    <p><small>You can append your own VDO.Ninja parameters to this link, treating it like a normal VDO.Ninja link.</small></p>
  </header>

  <div class="tabs">
    <div class="tab active" data-tab="websocket">WebSocket API</div>
    <div class="tab" data-tab="http">HTTP API</div>
    <div class="tab" data-tab="ptz">Camera Controls (PTZ)</div>
    <div class="tab" data-tab="guest">Guest Controls</div>
    <div class="tab" data-tab="logger">Request Logger</div>
  </div>

  <!-- WebSocket API Tab -->
  <div class="tab-content active" id="websocket-tab">
    <div class="section">
      <div class="section-title">Self Controls (WebSocket)</div>
      <div class="button-grid" id="ws-controls"></div>
    </div>
    
    <div class="section">
      <div class="section-title">Layout Controls (WebSocket)</div>
      <div class="button-grid" id="ws-layouts"></div>
    </div>
  </div>

  <!-- HTTP API Tab -->
  <div class="tab-content" id="http-tab">
    <div class="section">
      <div class="section-title">Self Controls (HTTP)</div>
      <div class="button-grid" id="http-controls"></div>
    </div>
    
    <div class="section">
      <div class="section-title">Group Controls (HTTP)</div>
      <div class="button-grid" id="http-groups"></div>
    </div>
  </div>

  <!-- PTZ Controls Tab -->
  <div class="tab-content" id="ptz-tab">
    <div class="section">
      <div class="section-title">Camera Controls (PTZ)</div>
      
      <div class="ptz-controls">
        <div class="control-group">
          <h3>Zoom</h3>
          <div class="button-grid">
            <button onclick="sendPTZCommand('zoom', 0.1)">Zoom In (0.1)</button>
            <button onclick="sendPTZCommand('zoom', -0.1)">Zoom Out (-0.1)</button>
          </div>
          <div class="slider-wrapper">
            <span class="slider-label">Absolute Zoom:</span>
            <div class="slider-container">
              <input type="range" min="0" max="100" value="50" class="slider" id="zoom-slider">
              <span class="slider-value" id="zoom-value">0.5</span>
            </div>
          </div>
        </div>
        
        <div class="control-group">
          <h3>Focus</h3>
          <div class="button-grid">
            <button onclick="sendPTZCommand('focus', 0.1)">Focus Far (0.1)</button>
            <button onclick="sendPTZCommand('focus', -0.1)">Focus Near (-0.1)</button>
          </div>
        </div>
        
        <div class="control-group">
          <h3>Pan & Tilt</h3>
          <div class="button-grid">
            <button onclick="sendPTZCommand('pan', -0.1)">Pan Left (-0.1)</button>
            <button onclick="sendPTZCommand('pan', 0.1)">Pan Right (0.1)</button>
            <button onclick="sendPTZCommand('tilt', 0.1)">Tilt Up (0.1)</button>
            <button onclick="sendPTZCommand('tilt', -0.1)">Tilt Down (-0.1)</button>
          </div>
        </div>
        
        <div class="control-group">
          <h3>Exposure</h3>
          <div class="slider-wrapper">
            <span class="slider-label">Exposure Level:</span>
            <div class="slider-container">
              <input type="range" min="0" max="100" value="50" class="slider" id="exposure-slider">
              <span class="slider-value" id="exposure-value">0.5</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Guest Controls Tab -->
  <div class="tab-content" id="guest-tab">
    <div class="section">
      <div class="section-title">Guest Controls (Directors Only)</div>
      <div>
        <label for="guest-slot">Guest Slot:</label>
        <select id="guest-slot" class="guest-slot-select">
          <option value="1">Guest 1</option>
          <option value="2">Guest 2</option>
          <option value="3">Guest 3</option>
          <option value="4">Guest 4</option>
        </select>
      </div>
      <div class="button-grid" id="guest-controls"></div>
    </div>
  </div>

  <!-- Logger Tab -->
  <div class="tab-content" id="logger-tab">
    <div class="section">
      <div class="section-title">
        API Request/Response Logger
        <button style="margin-left: auto; padding: 0.25rem 0.5rem;" onclick="clearLogs()">Clear</button>
      </div>
      <div class="api-logger" id="api-logger"></div>
    </div>
  </div>

  <footer style="text-align: center; margin-top: 2rem; color: var(--gray-600);">
    <p><small>Documentation and code at <a href="https://github.com/steveseguin/Companion-Ninja" target="_blank">github.com/steveseguin/Companion-Ninja</a></small></p>
  </footer>
</div>

<script>
(function (w) {
  w.URLSearchParams = w.URLSearchParams || function (searchString) {
    var self = this;
    self.searchString = searchString;
    self.get = function (name) {
      var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(self.searchString);
      if (results == null) {
        return null;
      } else {
        return decodeURI(results[1]) || 0;
      }
    };
  };
})(window);

// Prevent accidental page reloads
window.onbeforeunload = function() {
  return "Are you sure you want to leave this page? All connection settings will be lost.";
};

// Utility functions
function generateStreamID() {
  const possible = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789";
  let text = "";
  for (let i = 0; i < 10; i++) {
    text += possible.charAt(Math.floor(Math.random() * possible.length));
  }
  return text;
}

// Copy to clipboard
function copyToClipboard(element) {
  const text = element.textContent;
  navigator.clipboard.writeText(text).then(() => {
    // Show tooltip
    const tooltip = document.createElement('div');
    tooltip.className = 'tooltip-text';
    tooltip.style = 'position: fixed; background: #333; color: white; padding: 5px 10px; border-radius: 3px; z-index: 100; opacity: 0; transition: opacity 0.3s;';
    tooltip.textContent = 'Copied to clipboard!';
    
    element.appendChild(tooltip);
    setTimeout(() => {
      tooltip.style.opacity = '1';
    }, 10);
    
    setTimeout(() => {
      tooltip.style.opacity = '0';
      setTimeout(() => {
        element.removeChild(tooltip);
      }, 300);
    }, 2000);
  });
}

// Tab switching
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    tab.classList.add('active');
    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
  });
});

// Sliders
document.getElementById('zoom-slider').addEventListener('input', function() {
  const value = this.value / 100;
  document.getElementById('zoom-value').textContent = value.toFixed(2);
});

document.getElementById('zoom-slider').addEventListener('change', function() {
  const value = this.value / 100;
  sendPTZCommand('zoom', value, 'abs');
});

document.getElementById('exposure-slider').addEventListener('input', function() {
  const value = this.value / 100;
  document.getElementById('exposure-value').textContent = value.toFixed(2);
});

document.getElementById('exposure-slider').addEventListener('change', function() {
  const value = this.value / 100;
  sendPTZCommand('exposure', value);
});

// Logging functions
function clearLogs() {
  document.getElementById('api-logger').innerHTML = '';
}

function addLogEntry(type, method, endpoint, data, response) {
  const logger = document.getElementById('api-logger');
  const logEntry = document.createElement('div');
  logEntry.className = 'log-entry';
  
  const time = new Date().toLocaleTimeString();
  
  let html = `<span class="log-time">[${time}]</span>`;
  html += `<span class="log-method log-${method.toLowerCase()}">${method}</span>`;
  
  if (type === 'request') {
    html += `<span class="log-request">${endpoint}</span>`;
    if (data) {
      html += `<br><span class="log-request">Data: ${typeof data === 'object' ? JSON.stringify(data) : data}</span>`;
    }
  } else if (type === 'response') {
    html += `<span class="log-response">Response: ${typeof response === 'object' ? JSON.stringify(response) : response}</span>`;
  } else if (type === 'error') {
    html += `<span class="log-error">Error: ${data}</span>`;
  }
  
  logEntry.innerHTML = html;
  logger.appendChild(logEntry);
  logger.scrollTop = logger.scrollHeight;
}

// WebSocket setup
let socket = null;
let connecting = false;
let failedCount = 0;
let callbackID = parseInt(Math.random() * 1000);

function connect() {
  clearTimeout(connecting);
  if (socket) {
    if (socket.readyState === socket.OPEN) {
      updateConnectionStatus('connected');
      return;
    }
    try {
      socket.close();
    } catch (e) { }
  }
  
  updateConnectionStatus('connecting');
  socket = new WebSocket("wss://api.vdo.ninja:443");
  
  socket.onclose = function() {
    updateConnectionStatus('disconnected');
    failedCount += 1;
    clearTimeout(connecting);
    connecting = setTimeout(function() {
      connect();
    }, 100 * (failedCount - 1));
  };

  socket.onerror = function() {
    updateConnectionStatus('disconnected');
    failedCount += 1;
    clearTimeout(connecting);
    connecting = setTimeout(function() {
      connect();
    }, 100 * failedCount);
  };

  socket.onopen = function() {
    updateConnectionStatus('connected');
    failedCount = 0;
    try {
      socket.send(JSON.stringify({ "join": WID }));
      addLogEntry('request', 'WS', 'Connection', { "join": WID });
    } catch (e) {
      connecting = setTimeout(function() {
        connect();
      }, 1);
    }
  };
  
  socket.addEventListener('message', function(event) {
    if (event.data) {
      const data = JSON.parse(event.data);
      addLogEntry('response', 'WS', 'Message', null, data);
      
      if ("callback" in data) {
        if (data.callback.value == callbackID) {
          console.log("Received callback response:", data);
        }
      }
    }
  });
}

function updateConnectionStatus(status) {
  const indicator = document.getElementById('connection-indicator');
  const statusText = document.getElementById('connection-status');
  
  indicator.className = 'status-indicator';
  
  if (status === 'connected') {
    indicator.classList.add('status-connected');
    statusText.textContent = 'Connected';
    statusText.style.color = 'var(--success)';
  } else if (status === 'disconnected') {
    indicator.classList.add('status-disconnected');
    statusText.textContent = 'Disconnected';
    statusText.style.color = 'var(--danger)';
  } else {
    indicator.classList.add('status-connecting');
    statusText.textContent = 'Connecting...';
    statusText.style.color = 'var(--warning)';
  }
}

// Parse URL parameters
const urlParams = new URLSearchParams(window.location.search);
let WID = "testOBSN";

if (urlParams.has("api")) {
  WID = urlParams.get("api");
} else if (urlParams.has("osc")) {
  WID = urlParams.get("osc");
} else if (urlParams.has("id")) {
  WID = urlParams.get("id");
} else if (urlParams.has("ID")) {
  WID = urlParams.get("ID");
} else if (urlParams.has("wid")) {
  WID = urlParams.get("wid");
} else {
  WID = generateStreamID();
  
  const href = window.location.href;
  const arr = href.split('?');
  let newurl;
  if (arr.length > 1 && arr[1] !== '') {
    newurl = href + '&api=' + WID;
  } else {
    newurl = href + '?api=' + WID;
  }

  window.history.pushState({ path: newurl.toString() }, '', newurl.toString());
}

// Update the displayed API key
document.getElementById('api-key').textContent = WID;

// Create the VDO.Ninja link
const ninjaPath = "vdo.ninja";
const ninjaLink = document.getElementById('ninja-link');
ninjaLink.href = `https://${ninjaPath}/?api=${WID}`;
ninjaLink.textContent = `https://${ninjaPath}/?api=${WID}`;

// Connect to the WebSocket server
connect();

// Send messages via WebSocket
function sendMessage(msg) {
  if (!socket || socket.readyState !== socket.OPEN) {
    console.log("Not connected; message didn't send");
    connect();
    return;
  }
  
  try {
    if (typeof msg === 'object') {
      msg = JSON.stringify(msg);
    }
    socket.send(msg);
    addLogEntry('request', 'WS', 'Send Message', JSON.parse(msg));
  } catch (e) {
    connecting = setTimeout(function() {
      connect();
    }, 100);
  }
}

// Send guest-specific commands
function sendGuestCommand(target, action, value = null) {
  const msg = { "target": target, "action": action };
  if (value !== null) msg.value = value;
  
  sendMessage(JSON.stringify(msg));
}

// Send HTTP API requests
function ajax(data) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4) {
      if (this.status == 200) {
        addLogEntry('response', 'GET', 'HTTP Request', null, this.responseText);
      } else {
        addLogEntry('error', 'GET', 'HTTP Request', this.status);
      }
    }
  };
  
  var action = false;
  if ("action" in data) {
    action = data['action'];
  }
  
  var value = "null";
  if ("value" in data) {
    value = data['value'];
  }
  
  var apiid = false;
  if ("apiid" in data) {
    apiid = data['apiid'];
  }
  
  var target = "null";
  if ("target" in data) {
    target = data['target'];
  }
  
  if (!action || !apiid) {
    alert("No action or API ID provided; request won't work");
  } else {
    var URL = `https://api.vdo.ninja/${apiid}/${action}/${target}/${value}`;
    xhttp.open("GET", URL, true);
    xhttp.send();
    addLogEntry('request', 'GET', URL);
  }
}

// Create WebSocket control buttons
function createWebSocketControls() {
  const container = document.getElementById('ws-controls');
  container.innerHTML = '';
  
  // Define control buttons
  const controls = [
    { name: "Mic On", action: "mic", value: true, type: "true" },
    { name: "Mic Off", action: "mic", value: false, type: "false" },
    { name: "Mic Toggle", action: "mic", value: "toggle", type: "toggle" },
    
    { name: "Camera On", action: "camera", value: true, type: "true" },
    { name: "Camera Off", action: "camera", value: false, type: "false" },
    { name: "Camera Toggle", action: "camera", value: "toggle", type: "toggle" },
    
    { name: "Speaker On", action: "speaker", value: true, type: "true" },
    { name: "Speaker Off", action: "speaker", value: false, type: "false" },
    { name: "Speaker Toggle", action: "speaker", value: "toggle", type: "toggle" },
    
    { name: "Volume 100%", action: "volume", value: true, type: "true" },
    { name: "Volume 0%", action: "volume", value: false, type: "false" },
    { name: "Volume 50%", action: "volume", value: 50, type: "toggle" },
    
    { name: "Record Start", action: "record", value: true, type: "true" },
    { name: "Record Stop", action: "record", value: false, type: "false" },
    
    { name: "Bitrate Reset", action: "bitrate", value: true, type: "true" },
    { name: "Bitrate 0 (Pause)", action: "bitrate", value: false, type: "false" },
    { name: "Bitrate 1000kb", action: "bitrate", value: 1000, type: "toggle" },
    
    { name: "Toggle Hand", action: "togglehand", value: null, type: "toggle" },
    { name: "Reload Page", action: "reload", value: true, type: "toggle" },
    { name: "Hangup", action: "hangup", value: true, type: "false" },
    
    { name: "Force Keyframe", action: "forceKeyframe", value: null, type: "toggle" },
    { name: "Say Hello", action: "sendChat", value: "Hello", type: "toggle" },
    { name: "Overlay Hello", action: "sendDirectorChat", value: "Hello", type: "toggle" },
    
    { name: "Get Details", action: "getDetails", value: null, type: "toggle" },
    { name: "Highlight Toggle", action: "soloVideo", value: "toggle", type: "toggle" },
  ];
  
  // Create and add buttons to the container
  controls.forEach(control => {
    const button = document.createElement('button');
    button.textContent = control.name;
    button.setAttribute('data-type', control.type);
    
    // Create tooltip with request details
    const tooltip = document.createElement('span');
    tooltip.className = 'tooltip-text';
    
    // Format the request info based on the control
    let apiFormat = `WS: {"action":"${control.action}"`;
    if (control.value !== null) {
      apiFormat += `,"value":${typeof control.value === 'string' ? `"${control.value}"` : control.value}`;
    }
    apiFormat += "}";
    
    tooltip.textContent = apiFormat;
    
    // Add tooltip to button
    button.classList.add('tooltip');
    button.appendChild(tooltip);
    
    // Set onclick handler
    button.onclick = function() {
      const msg = { action: control.action };
      if (control.value !== null) msg.value = control.value;
      sendMessage(JSON.stringify(msg));
    };
    
    container.appendChild(button);
  });
}

// Create layout control buttons
function createLayoutControls() {
  const container = document.getElementById('ws-layouts');
  container.innerHTML = '';
  
  // Create buttons for layouts 0-8
  for (let i = 0; i <= 8; i++) {
    const button = document.createElement('button');
    const name = i === 0 ? "Auto-Mix" : `Layout ${i}`;
    button.textContent = name;
    button.setAttribute('data-type', "toggle");
    
    // Create tooltip with request details
    const tooltip = document.createElement('span');
    tooltip.className = 'tooltip-text';
    tooltip.textContent = `WS: {"action":"layout","value":${i}}`;
    
    // Add tooltip to button
    button.classList.add('tooltip');
    button.appendChild(tooltip);
    
    // Set onclick handler
    button.onclick = function() {
      sendMessage(JSON.stringify({ "action": "layout", "value": i }));
    };
    
    container.appendChild(button);
  }
}

// Create HTTP API buttons
function createHTTPControls() {
  const container = document.getElementById('http-controls');
  container.innerHTML = '';
  
  // Define HTTP API buttons
  const controls = [
    { name: "Mic On", action: "mic", value: true, type: "true" },
    { name: "Mic Off", action: "mic", value: false, type: "false" },
    { name: "Mic Toggle", action: "mic", value: "toggle", type: "toggle" },
    
    { name: "Camera On", action: "camera", value: true, type: "true" },
    { name: "Camera Off", action: "camera", value: false, type: "false" },
    { name: "Camera Toggle", action: "camera", value: "toggle", type: "toggle" },
    
    { name: "Speaker On", action: "speaker", value: true, type: "true" },
    { name: "Speaker Off", action: "speaker", value: false, type: "false" },
    { name: "Speaker Toggle", action: "speaker", value: "toggle", type: "toggle" },
    
    { name: "Volume 100%", action: "volume", value: true, type: "true" },
    { name: "Volume 0%", action: "volume", value: false, type: "false" },
    { name: "Volume 50%", action: "volume", value: 50, type: "toggle" },
    
    { name: "Record Start", action: "record", value: true, type: "true" },
    { name: "Record Stop", action: "record", value: false, type: "false" },
    
    { name: "Bitrate Reset", action: "bitrate", value: true, type: "true" },
    { name: "Bitrate 0 (Pause)", action: "bitrate", value: false, type: "false" },
    { name: "Bitrate 1000kb", action: "bitrate", value: 1000, type: "toggle" },
  ];
  
  // Create and add buttons to the container
  controls.forEach(control => {
    const button = document.createElement('button');
    button.textContent = control.name;
    button.setAttribute('data-type', control.type);
    
    // Create tooltip with request details
    const tooltip = document.createElement('span');
    tooltip.className = 'tooltip-text';
    
    // Format the request info based on the control
    let apiFormat = `GET: https://api.vdo.ninja/${WID}/${control.action}/null/`;
    if (control.value !== null) {
      apiFormat += typeof control.value === 'string' ? control.value : control.value;
    }
    
    tooltip.textContent = apiFormat;
    
    // Add tooltip to button
    button.classList.add('tooltip');
    button.appendChild(tooltip);
    
    // Set onclick handler
    button.onclick = function() {
      ajax({ 
        "action": control.action, 
        "value": control.value, 
        "apiid": WID 
      });
    };
    
    container.appendChild(button);
  });
}

// Create HTTP Group Controls
function createHTTPGroupControls() {
  const container = document.getElementById('http-groups');
  container.innerHTML = '';
  
  // Define group controls
  const groups = [1, 2];
  const actions = [
    { name: "Toggle", action: "group" },
    { name: "Join", action: "joinGroup" },
    { name: "Leave", action: "leaveGroup" }
  ];
  
  // Create and add group buttons
  groups.forEach(group => {
    actions.forEach(actionObj => {
      const button = document.createElement('button');
      button.textContent = `Group ${group}: ${actionObj.name}`;
      button.setAttribute('data-type', "toggle");
      
      // Create tooltip with request details
      const tooltip = document.createElement('span');
      tooltip.className = 'tooltip-text';
      tooltip.textContent = `GET: https://api.vdo.ninja/${WID}/${actionObj.action}/null/${group}`;
      
      // Add tooltip to button
      button.classList.add('tooltip');
      button.appendChild(tooltip);
      
      // Set onclick handler
      button.onclick = function() {
        ajax({ 
          "action": actionObj.action, 
          "value": group, 
          "apiid": WID 
        });
      };
      
      container.appendChild(button);
    });
  });
  
  // Create view group buttons
  groups.forEach(group => {
    const viewActions = [
      { name: "View Toggle", action: "viewGroup" },
      { name: "View Join", action: "joinViewGroup" },
      { name: "View Leave", action: "leaveViewGroup" }
    ];
    
    viewActions.forEach(actionObj => {
      const button = document.createElement('button');
      button.textContent = `${actionObj.name} ${group}`;
      button.setAttribute('data-type', "toggle");
      
      // Create tooltip with request details
      const tooltip = document.createElement('span');
      tooltip.className = 'tooltip-text';
      tooltip.textContent = `GET: https://api.vdo.ninja/${WID}/${actionObj.action}/null/${group}`;
      
      // Add tooltip to button
      button.classList.add('tooltip');
      button.appendChild(tooltip);
      
      // Set onclick handler
      button.onclick = function() {
        ajax({ 
          "action": actionObj.action, 
          "value": group, 
          "apiid": WID 
        });
      };
      
      container.appendChild(button);
    });
  });
  
  // Add PowerPoint control buttons
  const ppControls = [
    { name: "Next Slide", action: "nextSlide" },
    { name: "Prev Slide", action: "prevSlide" }
  ];
  
  ppControls.forEach(control => {
    const button = document.createElement('button');
    button.textContent = control.name;
    button.setAttribute('data-type', "toggle");
    
    // Create tooltip with request details
    const tooltip = document.createElement('span');
    tooltip.className = 'tooltip-text';
    tooltip.textContent = `GET: https://api.vdo.ninja/${WID}/${control.action}/null/null`;
    
    // Add tooltip to button
    button.classList.add('tooltip');
    button.appendChild(tooltip);
    
    // Set onclick handler
    button.onclick = function() {
      ajax({ 
        "action": control.action, 
        "apiid": WID 
      });
    };
    
    container.appendChild(button);
  });
}

// Create guest control buttons
function createGuestControls() {
  const container = document.getElementById('guest-controls');
  container.innerHTML = '';
  
  // Define guest controls
  const controls = [
    { name: "Mute Mic", action: "mic", type: "toggle" },
    { name: "Toggle Camera", action: "camera", type: "toggle" },
    { name: "Hangup", action: "hangup", type: "false" },
    { name: "Solo Chat", action: "soloChat", type: "toggle" },
    { name: "Two-way Solo Chat", action: "soloChatBidirectional", type: "toggle" },
    { name: "Toggle Speaker", action: "speaker", type: "toggle" },
    { name: "Toggle Display", action: "display", type: "toggle" },
    { name: "Fix Rainbow", action: "forceKeyframe", type: "toggle" },
    { name: "Highlight", action: "soloVideo", type: "toggle" },
    { name: "Add to Scene 0", action: "addScene", value: 0, type: "toggle" },
    { name: "Add to Scene 1", action: "addScene", value: 1, type: "toggle" },
    { name: "Add to Scene 2", action: "addScene", value: 2, type: "toggle" },
    { name: "Add to Group 1", action: "group", value: 1, type: "toggle" },
    { name: "Add to Group 2", action: "group", value: 2, type: "toggle" },
    { name: "Say Hello", action: "sendChat", value: "hello", type: "toggle" },
    { name: "Overlay Hello", action: "sendDirectorChat", value: "hello", type: "toggle" },
    { name: "Start Timer (10m)", action: "startRoomTimer", value: 600, type: "toggle" },
    { name: "Pause Timer", action: "pauseRoomTimer", type: "toggle" },
    { name: "Stop Timer", action: "stopRoomTimer", type: "toggle" },
    { name: "Forward to room321", action: "forward", value: "room321", type: "toggle" },
  ];
  
  // Create and add buttons to the container
  controls.forEach(control => {
    const button = document.createElement('button');
    button.textContent = control.name;
    button.setAttribute('data-type', control.type);
    
    // Create tooltip with request details
    const tooltip = document.createElement('span');
    tooltip.className = 'tooltip-text';
    
    // Set onclick handler
    button.onclick = function() {
      const guestSlot = document.getElementById('guest-slot').value;
      const tooltipText = `WS: {"target":"${guestSlot}","action":"${control.action}"${control.value !== undefined ? `,"value":${typeof control.value === 'string' ? `"${control.value}"` : control.value}` : ''}}`;
      tooltip.textContent = tooltipText;
      
      sendGuestCommand(
        guestSlot, 
        control.action, 
        control.value !== undefined ? control.value : null
      );
    };
    
    // Add tooltip to button
    button.classList.add('tooltip');
    button.appendChild(tooltip);
    
    container.appendChild(button);
  });
  
  // Add volume slider for guest
  const sliderWrapper = document.createElement('div');
  sliderWrapper.className = 'slider-wrapper';
  sliderWrapper.style.marginTop = '1rem';
  
  const sliderLabel = document.createElement('span');
  sliderLabel.className = 'slider-label';
  sliderLabel.textContent = 'Guest Mic Volume:';
  sliderWrapper.appendChild(sliderLabel);
  
  const sliderContainer = document.createElement('div');
  sliderContainer.className = 'slider-container';
  
  const slider = document.createElement('input');
  slider.type = 'range';
  slider.min = '0';
  slider.max = '200';
  slider.value = '100';
  slider.className = 'slider';
  slider.id = 'guest-volume-slider';
  
  const sliderValue = document.createElement('span');
  sliderValue.className = 'slider-value';
  sliderValue.id = 'guest-volume-value';
  sliderValue.textContent = '100';
  
  sliderContainer.appendChild(slider);
  sliderContainer.appendChild(sliderValue);
  sliderWrapper.appendChild(sliderContainer);
  
  slider.addEventListener('input', function() {
    sliderValue.textContent = this.value;
  });
  
  slider.addEventListener('change', function() {
    const guestSlot = document.getElementById('guest-slot').value;
    sendGuestCommand(guestSlot, "volume", parseInt(this.value));
  });
  
  container.appendChild(sliderWrapper);
}

// PTZ Camera Controls
function sendPTZCommand(action, value, value2 = null) {
  const command = { action: action, value: value };
  if (value2) command.value2 = value2;
  
  sendMessage(JSON.stringify(command));
}

// Initialize all controls
document.addEventListener('DOMContentLoaded', function() {
  createWebSocketControls();
  createLayoutControls();
  createHTTPControls();
  createHTTPGroupControls();
  createGuestControls();
});
</script>
</body>
</html>
